#!/usr/bin/env cwl-runner

description: |
    description: "Running sambamba index"
    Usage:  cwl-runner <this-file-path> options

requirements:
  - import: node-engine.cwl
  - class: ShellCommandRequirement
  - class: InlineJavascriptRequirement
  - class: DockerRequirement
    dockerPull: quay.io/ncigdc/variant-filtration-tool:0.1

class: CommandLineTool

inputs:
  - id: "#threads"
    type: int 
    default: null 
    label: "Threads"
    description: "Number of threads to use"
    inputBinding:
        position: 0 
        prefix: -t

  - id: "#bam_file"
    type: File
    label: "Input BAM file"
    description: "path to BAM file you wish to index"
    inputBinding:
        position: 1 

outputs:
    - id: "#bai"
      type: File
      description: "bam index file"
      outputBinding:
          glob: $(inputs['bam_file'].path.split(/[\\/]/).pop() + '.bai')

    - id: "#log_file"
      type: File
      description: "stdout file"
      outputBinding:
          glob: $(inputs['bam_file'].path.split(/[\\/]/).pop() + '.logs')

    - id: "#time_file"
      type: File
      description: "time file"
      outputBinding:
          glob: $(inputs['bam_file'].path.split(/[\\/]/).pop() + '.time')

baseCommand: ["/usr/bin/time", "-v"]

arguments:
  - valueFrom: $(inputs['bam_file'].path.split(/[\\/]/).pop() + '.time')
    position: -99
    prefix: "-o"

  - valueFrom: "/home/ubuntu/tools/sambamba/sambamba"
    position: -98

  - valueFrom: "index" 
    position: -97

  - valueFrom: $(inputs['bam_file'].path.split(/[\\/]/).pop() + '.bai')
    position: 2

  - valueFrom: $(inputs['bam_file'].path.split(/[\\/]/).pop() + '.logs')
    position: 3 
    prefix: ">"

  - valueFrom: '2>&1' 
    position: 4 
    shellQuote: false 
