#!/usr/bin/env cwl-runner

description: |
    description: "Filter VCF by Somatic Score"
    Usage:  cwl-runner <this-file-path> options

requirements:
  - import: node-engine.cwl
  - class: InlineJavascriptRequirement
  - class: ShellCommandRequirement 
  - class: DockerRequirement
    dockerPull: quay.io/ncigdc/variant-filtration-tool:0.1

class: CommandLineTool

inputs:
  - id: "#input_vcf"
    type: File
    label: "Input VCF"
    description: "Path to input VCF file"
    inputBinding:
        prefix: --input_vcf

  - id: "#output_vcf"
    type: string 
    label: "Output VCF"
    description: "Path to output filtered VCF file"
    inputBinding:
        prefix: --output_vcf

  - id: "#tumor_sample_name"
    type: string 
    default: 'TUMOR'
    label: "Tumor name"
    description: "Tumor sample's name in the VCF file"
    inputBinding:
        prefix: --tumor_sample_name

  - id: "#drop_somatic_score"
    type: int 
    default: null 
    label: "Drop somatic score"
    description: "If the somatic score is < this, remove it"
    inputBinding:
        prefix: --drop_somatic_score 
 
  - id: "#min_somatic_score"
    type: int 
    default: null 
    label: "Min somatic score"
    description: "If the somatic score is > drop_somatic_score and < this value, add ssc filter tag"
    inputBinding:
        prefix: --min_somatic_score 

outputs:
  - id: "#vcf_out"
    type: File
    description: "filtered vcf"
    outputBinding:
        glob: $(inputs['output_vcf'])

  - id: "#log_file"
    type: File
    description: "stdout file"
    outputBinding:
        glob: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.logs')

  - id: "#time_file"
    type: File
    description: "time file"
    outputBinding:
        glob: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.time')

baseCommand: ["/usr/bin/time", "-v"]

arguments:
  - valueFrom: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.time')
    position: -99
    prefix: "-o"

  - valueFrom: "/home/ubuntu/.virtualenvs/p3/bin/python"
    position: -98

  - valueFrom: "/home/ubuntu/tools/variant-filtration-tool/main.py"
    position: -97

  - valueFrom: "somaticscore"
    position: -96

  - valueFrom: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.logs')
    position: 99
    prefix: ">"

  - valueFrom: '2>&1'
    position: 100
    shellQuote: false
